!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("_"),require("jQuery")):"function"==typeof define&&define.amd?define(["_","jQuery"],t):"object"==typeof exports?exports.TreeShaker=t(require("_"),require("jQuery")):e.TreeShaker=t(e._,e.jQuery)}(this,function(e,t){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,t,n){Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=23)}([function(t,n){t.exports=e},function(e,t){"use strict";e.exports=function(e,t){for(var n=e.parent;n&&n!==t;){if(n.next)return n.next;n=n.parent}return null}},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(5),s=n(1),a=n(20),l=n(6),c=n(18),u=n(22),h=n(21),d=n(17),p=n(19),f=function(){function e(t){if(i(this,e),this.rootNode=e.createEmptyNode("root"),this.index={},t)for(var n=t.length,o=0;o<n;o+=1)this.addRawNode(t[o])}return o(e,null,[{key:"createEmptyNode",value:function(e){return{first:null,id:e,last:null,next:null,parent:null,prev:null}}}]),o(e,[{key:"getNodeById",value:function(e){return this.index[e]}},{key:"removeNode",value:function(e){var t=e.id,n=e.parent,i=e.prev,o=e.next;!i&&n&&(n.first=o),!o&&n&&(n.last=i),o&&(o.prev=i),i&&(i.next=o),e.next=null,e.prev=null,e.parent=null,delete this.index[t]}},{key:"moveNodeToParent",value:function(e,t){if(e.parent!==t){this.removeNode(e),e.parent=t;var n=t.last;n?(n.next=e,e.prev=n,t.last=e):(t.first=e,t.last=e),this.index[e.id]=e}}},{key:"addRawNode",value:function(t){var n=t.id,i=t.parentId,o=this.getNodeById(n)||e.createEmptyNode(n),r=i&&(this.getNodeById(i)||this.addRawNode({id:i}));return r?this.moveNodeToParent(o,r):this.moveNodeToParent(o,this.rootNode),this.index[n]=o,o.data=t,o}},{key:"toList",value:function(){return e.toList(this.rootNode)}},{key:"getAncestors",value:function(t){return e.getAncestors(t,this.rootNode)}},{key:"findFirst",value:function(t){return e.findFirst(this.rootNode,t)}},{key:"filterWithAncestors",value:function(t){return e.filterWithAncestors(this.rootNode,t)}},{key:"forEach",value:function(t){return e.forEach(this.rootNode,t)}}]),e}();f.getAncestors=r,f.getNearestAncestorWithNext=s,f.getChildren=a,f.toList=l,f.findFirst=c,f.moveNodeUp=u,f.moveNodeDown=h,f.filterWithAncestors=d,f.forEach=p,e.exports=f},function(e,t){"use strict";e.exports=function(){var e={};return function(t){if(e[t.id])throw new Error('Looping detected "'+t.id+'"');e[t.id]=!0}}},function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(0);e.exports=function(){for(var e={},t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach(function(t){"string"==typeof t&&(e[t]=!0),"object"===("undefined"==typeof t?"undefined":i(t))&&o.assign(e,t)}),o.map(e,function(e,t){return e&&t}).filter(Boolean).join(" ")}},function(e,t){"use strict";e.exports=function(e,t){for(var n=[],i=e.parent;i&&i!==t;)n.push(i),i=i.parent;return n}},function(e,t,n){"use strict";var i=n(3),o=n(1);e.exports=function(e){for(var t=[],n=i(),r=e.first;r;)n(r),t.push(r),r=r.first||r.next||o(r,e);return t}},function(e,n){e.exports=t},function(e,t,n){"use strict";var i=n(7),o=n(4);e.exports=function(e,t){var n=e.$availableSelect,r=e.$chosenSelect,s=e.$filterInput,a=e.$moveDownButton,l=e.$moveToChosenButton,c=e.$moveUpButton,u=e.$removeFromChosenButton,h=i('<div class="'+o(t.container)+'"></div>'),d=i('<div class="'+o(t.filter.container)+'"></div>'),p=i('<div class="'+o(t.columnAvailable)+'"></div>'),f=i('<div class="'+o(t.columnChosen)+'"></div>'),v=i('<div class="'+o(t.buttonsMove.container)+'"></div>'),m=i('<div class="'+o(t.buttonsMove.content)+'"></div>'),g=i('<div class="'+o(t.buttonsSort.container)+'"></div>'),b=i('<div class="'+o(t.buttonsSort.content)+'"></div>');return h.append(p.append(d.append(s)).append(n).append(v.append(m.append(l).append(u)))).append(f.append(r).append(g.append(b.append(c).append(a))))}},function(e,t){"use strict";e.exports=function(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}},function(e,t,n){"use strict";function i(e){function t(e){var t=e.id,o=e.data,s=i.getNodeById(o.parentId),a={availableNode:e,id:t};s&&(a.parentId=s.id);var l=i.addRawNode(a);return r.getChildren(e).forEach(function(e){var t=i.getNodeById(e.id);t&&i.moveNodeToParent(t,l)}),n.getAncestors(e).reverse().forEach(function(e){var t=i.getNodeById(e.id);t&&i.moveNodeToParent(l,t)}),o.selected=!1,o.disabled=!0,l}for(var n=e.available,i=e.chosen,s=n.toList(),a=o.filter(s,function(e){return e.data.selected}),l=[].concat(a),c=a.length,u=function(e){var t=a[e],n=[],i=r.findFirst(t,function(e){return e.data.disabled||e.data.hidden||n.push(e),e.data.selected});i||(l=l.concat(n))},h=0;h<c;h+=1)u(h);return l.forEach(t),e}var o=n(0),r=n(2);e.exports=i},function(e,t,n){"use strict";function i(e){var t=e.available,n=e.chosen,i=n.toList(),s=o.filter(i,function(e){return e.data.selected}),a=[].concat(s);return s.forEach(function(e){var t=[],n=r.findFirst(e,function(e){return e.data.disabled||t.push(e),e.data.selected});n||(a=a.concat(t))}),a.forEach(function(e){n.removeNode(e);var i=t.getNodeById(e.id);i.data.disabled=!1}),e}var o=n(0),r=n(2);e.exports=i},function(e,t,n){"use strict";function i(e){return!!e&&e.toList().filter(function(t){if(!t.data.selected)return!1;var n=e.getAncestors(t),i=a.some(n,function(e){return e.data.selected});return!i})}function o(e,t){var n=!1;return a.each(a.groupBy(t,"parent"),function(t){for(var i=t.length,o=0,r=!0;r&&o<i;){var s=t[o];r="up"===e?l.moveNodeUp(s):l.moveNodeDown(s),r&&(n=!0),o+=1}}),n}function r(e){return o("up",e)}function s(e){return o("down",e.reverse())}var a=n(0),l=n(2);e.exports={getNodesForSorting:i,moveDown:s,moveUp:r}},function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(0),a=n(7),l=n(16),c=n(4),u=n(14),h=n(15),d=200,p=10,f=function(){function e(t){o(this,e),this.handleScroll=this.handleScroll.bind(this),this.handleOptionClick=this.handleOptionClick.bind(this),this.props={};var n=this.props.classNames={disabled:s.get(t,"classNames.disabled",""),option:s.get(t,"classNames.option",""),select:s.get(t,"classNames.select",""),selected:s.get(t,"classNames.selected","")};this.props.optionHeight=t.optionHeight,this.props.optionTemplate=t.optionTemplate,this.props.onSelect=t.onSelect,this.props.onDblclick=t.onDblclick,this.props.templates=t.templates,this.props.getOptionById=t.getOptionById,this.dblclickTimeout=null,this.$topPad=a("<div></div>"),this.$bottomPad=a("<div></div>"),this.$element=a('<div class="'+n.select+'"></div>').prepend(this.$topPad).append(this.$bottomPad).on("scroll",this.handleScroll).delegate("[data-option-id]","click",this.handleOptionClick);var i=u();i&&i<p&&this.$element.on("selectstart",function(){return!1}),this.refresh()}return r(e,[{key:"updateHeight",value:function(){this.height=this.$element.height(),this.handleScroll()}},{key:"refresh",value:function(e){this.options=e||[],this.visibleOptions=[],this.lastClicked=null,this.bottomPadHeight=0,this.topPadHeight=0,this.updateScrolling()}},{key:"updateScrolling",value:function(){var e=this.height,t=this.visibleOptions,n=this.props.optionHeight,i=this.options,o=this.$element.scrollTop(),r=h({containerHeight:e,currentVisibleItems:t,itemHeight:n,items:i,scrollTop:o});if(!r)return null;var s=r.bottomPadHeight,a=r.topPadHeight,l=r.visibleItems;return this.bottomPadHeight=s,this.topPadHeight=a,this.visibleOptions=l,l}},{key:"getAvailableIdsForSections",value:function(){return s.filter(this.options,function(e){return!e.data.disabled})}},{key:"getLastClicked",value:function(){return this.lastClicked||this.options[0]}},{key:"setLastClicked",value:function(e){var t=this;this.waitDblclick=!0,this.dblclickTimeout=setTimeout(function(){t.waitDblclick=!1},d),this.lastClicked=e}},{key:"handleScroll",value:function(){var e=this.updateScrolling();e&&this.render()}},{key:"handleOptionClick",value:function(e){function t(){return e.shiftKey?"region":s.some([e.ctrlKey,e.metaKey,e.altKey])?"toggle":"single"}var n=this,i=a(e.currentTarget).data("option-id").toString(),o=this.props.getOptionById(i),r=this.getAvailableIdsForSections();if(s.includes(r,o)){var c=this.getLastClicked(),u=this.waitDblclick&&c===o,h={region:function(){return l(r,o,c)},single:function(){n.setLastClicked(o),n.options.forEach(function(e){e.data.selected=e===o})},toggle:function(){n.setLastClicked(o),o.data.selected=!o.data.selected}},d=t(),p=h[d];p(),this.render(),this.props.onSelect(),u&&"single"===d&&this.props.onDblclick()}}},{key:"getOptionElement",value:function(e){var t,n=this.props.classNames,o=e.id,r=e.data,s=r.disabled,l=r.selected,u=c(n.option,(t={},i(t,n.disabled,s),i(t,n.selected,l),t)),h=a('<div class="'+u+'" data-option-id="'+o+'"></div>');return h.append(this.props.templates.getElement(e)),h}},{key:"updateOptionElement",value:function(e,t){var n,o=this.props.classNames,r=e.data,s=r.disabled,a=r.selected,l=c((n={},i(n,o.option,!0),i(n,o.disabled,s),i(n,o.selected,a),n));return t.attr({class:l}),this.props.templates.updateElement(e,t.children()),t}},{key:"removeHiddenElements",value:function(){for(var e=this.$element.children("[data-option-id]"),t=e.length,n=this.visibleOptions,i=0;i<t;i+=1){var o=e.eq(i),r=o.data("option-id");s.find(n,{id:r})||o.remove()}}},{key:"addOrUpdateVisibleElements",value:function(){for(var e=this.$element.children("[data-option-id]"),t=this.visibleOptions,n=t.length,i=this.$topPad,o=0;o<n;o+=1){var r=t[o],s=e.filter('[data-option-id="'+r.id+'"]'),a=null;a=s.length?this.updateOptionElement(r,s):this.getOptionElement(r,s),a.prev().is(i)||a.insertAfter(i),i=a}}},{key:"render",value:function(){var e=this.$topPad,t=this.$bottomPad;e.height(this.topPadHeight),t.height(this.bottomPadHeight),this.removeHiddenElements(),this.addOrUpdateVisibleElements()}}]),e}();e.exports=f},function(e,t){"use strict";function n(e){var t=e||window&&navigator.userAgent.toLowerCase();return t?t.indexOf("msie")===-1?null:parseInt(t.split("msie")[1],10):null}e.exports=n},function(e,t,n){"use strict";function i(e){var t=e.containerHeight,n=e.currentVisibleItems,i=e.itemHeight,r=e.items,s=e.scrollTop,a=Math.ceil(t/i)+1,l=Math.floor(s/i),c=r.length,u=Math.min(c-1,l),h=u+a,d=r.slice(u,h),p=o.difference(d,n).length;if(!p)return null;var f=u*i,v=Math.max(0,c-h)*i;return{bottomPadHeight:v,topPadHeight:f,visibleItems:d}}var o=n(0);e.exports=i},function(e,t,n){"use strict";function i(e,t,n){function i(e,t){(e||s)&&(s=!0,t.data.selected=!0)}for(var r=e.length,s=!1,a=0;a<r;a+=1){var l=e[a],c=o.includes([t,n],l);if(c&&s)return void(l.data.selected=!0);i(c,l)}}var o=n(0);e.exports=i},function(e,t,n){"use strict";var i=n(3),o=n(5),r=n(1),s=n(6);e.exports=function(e,t){function n(e){var t=e.id;u[t]||(l.push(e),u[t]=!0)}function a(i){t(i)&&(o(i,e).reverse().forEach(n),n(i),s(i).forEach(n))}for(var l=[],c=i(),u={},h=e.first;h;)c(h),a(h),h=h.first||h.next||r(h,e);return l}},function(e,t,n){"use strict";var i=n(3),o=n(1);e.exports=function(e,t){for(var n=i(),r=e.first;r;){if(n(r),t(r))return r;r=r.first||r.next||o(r,e)}return null}},function(e,t,n){"use strict";var i=n(3),o=n(1);e.exports=function(e,t){for(var n=i(),r=e.first;r;)n(r),t(r),r=r.first||r.next||o(r,e)}},function(e,t){"use strict";e.exports=function(e){for(var t=[],n=e.first;n;)t.push(n),n=n.next;return t}},function(e,t){"use strict";e.exports=function(e){function t(){if(o){var t=o.last,n=o.first;t===i&&(o.last=e),n===e&&(o.first=i)}}if(!e.next)return!1;var n=e.prev,i=e.next,o=e.parent;return e.prev=i,e.next=i.next,e.next&&(e.next.prev=e),i.next=e,i.prev=n,n&&(n.next=i,i.prev=n),t(),!0}},function(e,t){"use strict";e.exports=function(e){function t(){if(o){var t=o.last,i=o.first;i===n&&(o.first=e),t===e&&(o.last=n)}}if(!e.prev)return!1;var n=e.prev,i=e.next,o=e.parent;return e.prev=n.prev,e.next=n,e.prev&&(e.prev.next=e),n.prev=e,n.next=i,i&&(i.prev=n,n.next=i),t(),!0}},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return!!e&&Boolean(e.findFirst(function(e){return e.data.selected}))}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(0),a=n(13),l=n(8),c=n(2),u=n(10),h=n(11),d=n(9),p=n(12),f=p.getNodesForSorting,v=p.moveUp,m=p.moveDown,g=24,b=function(){function e(t){i(this,e),this.props={},this.props.templates=t.templates,this.props.classNames=t.classNames,this.createAvailableSelect(),this.createChosenSelect(),this.createMovingButtons(),this.createSortingButtons(),this.createFilterInput(),this.assembleElements()}return r(e,[{key:"createAvailableSelect",value:function(){var e=this,t=this.props.classNames;this.handleMoveToChosenClick=this.handleMoveToChosenClick.bind(this),this.handleAvailableSelect=this.handleAvailableSelect.bind(this);var n=s.assign({},t.select,{select:t.select.select+" "+t.selectAvailable});this.availableSelect=new a({classNames:n,getOptionById:function(t){return e.availableTree.getNodeById(t)},onDblclick:this.handleMoveToChosenClick,onSelect:this.handleAvailableSelect,optionHeight:g,templates:this.props.templates.available})}},{key:"createChosenSelect",value:function(){var e=this,t=this.props.classNames;this.handleRemoveFromChosenClick=this.handleRemoveFromChosenClick.bind(this),this.handleChosenSelect=this.handleChosenSelect.bind(this);var n=s.assign({},t.select,{select:t.select.select+" "+t.selectChosen});this.chosenSelect=new a({classNames:n,getOptionById:function(t){return e.chosenTree.getNodeById(t)},onDblclick:this.handleRemoveFromChosenClick,onSelect:this.handleChosenSelect,optionHeight:g,templates:this.props.templates.chosen})}},{key:"createMovingButtons",value:function(){var e=this.props.templates;this.$moveToChosenButton=e.moveToChosenButton.getElement().on("click",this.handleMoveToChosenClick),this.$removeFromChosenButton=e.removeFromChosenButton.getElement().on("click",this.handleRemoveFromChosenClick),this.refreshMoveToChosenButton(),this.refreshRemoveToChosenButton()}},{key:"createSortingButtons",value:function(){var e=this.props.templates;this.handleMoveUpClick=this.handleMoveUpClick.bind(this),this.handleMoveDownClick=this.handleMoveDownClick.bind(this),this.$moveUpButton=e.moveUpButton.getElement().on("click",this.handleMoveUpClick),this.$moveDownButton=e.moveDownButton.getElement().on("click",this.handleMoveDownClick),this.refreshMoveUpButton(),this.refreshMoveDownButton()}},{key:"createFilterInput",value:function(){var e=this.props.templates;this.handleFilterInputChange=this.handleFilterInputChange.bind(this),this.$filterInput=e.inputFilter.getElement().on("keyup",this.handleFilterInputChange)}},{key:"setNodes",value:function(e){this.availableTree=new c(e),this.chosenTree=new c([]),this.refresh()}},{key:"handleAvailableSelect",value:function(){this.refreshMoveToChosenButton()}},{key:"handleChosenSelect",value:function(){this.refreshRemoveToChosenButton(),this.refreshMoveUpButton(),this.refreshMoveDownButton()}},{key:"handleMoveToChosenClick",value:function(){u({available:this.availableTree,chosen:this.chosenTree}),this.refresh()}},{key:"handleRemoveFromChosenClick",value:function(){h({available:this.availableTree,chosen:this.chosenTree}),this.refresh()}},{key:"handleMoveUpClick",value:function(){var e=f(this.chosenTree);e.length&&v(e)&&this.refresh()}},{key:"handleMoveDownClick",value:function(){var e=f(this.chosenTree);e.length&&m(e)&&this.refresh()}},{key:"handleFilterInputChange",value:function(){var e=this.$filterInput.val(),t=new RegExp(d(e),"ig");this.availableTree.forEach(function(e){e.data.selected=!1,e.data.hidden=!e.data.name.match(t)}),this.refresh()}},{key:"refreshMoveToChosenButton",value:function(){this.$moveToChosenButton.attr({disabled:!o(this.availableTree)})}},{key:"refreshRemoveToChosenButton",value:function(){this.$removeFromChosenButton.attr({disabled:!o(this.chosenTree)})}},{key:"refreshMoveUpButton",value:function(){this.$moveUpButton.attr({disabled:!o(this.chosenTree)})}},{key:"refreshMoveDownButton",value:function(){this.$moveDownButton.attr({disabled:!o(this.chosenTree)})}},{key:"refresh",value:function(){function e(e){return!e.data.hidden}this.availableSelect.refresh(this.availableTree.filterWithAncestors(e)),this.availableSelect.render(),this.chosenSelect.refresh(this.chosenTree.filterWithAncestors(e)),this.chosenSelect.render(),this.refreshMoveToChosenButton(),this.refreshRemoveToChosenButton(),this.refreshMoveUpButton(),this.refreshMoveDownButton()}},{key:"updateHeight",value:function(){this.availableSelect.updateHeight(),this.chosenSelect.updateHeight()}},{key:"assembleElements",value:function(){var e=this.props.classNames,t=this.$filterInput,n=this.$moveToChosenButton,i=this.$removeFromChosenButton,o=this.$moveUpButton,r=this.$moveDownButton,s=this.availableSelect.$element,a=this.chosenSelect.$element;this.$element=l({$availableSelect:s,$chosenSelect:a,$filterInput:t,$moveDownButton:r,$moveToChosenButton:n,$moveUpButton:o,$removeFromChosenButton:i},e)}}]),e}();b.Tree=c,e.exports=b}])});